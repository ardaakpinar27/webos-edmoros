<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EdmorOs - Your WebOs</title>
    <link rel="icon" type="image/jpeg" href="https://filedn.eu/liPnBWWQgeQVeGgdPoPnl8S/edmoroslogo.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        :root {
            --base-font-size: 16px;
            --ui-scale: 0.8;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: 'Inter', sans-serif; overflow: hidden;
            background: #020617; user-select: none;
            font-size: var(--base-font-size);
            image-rendering: -webkit-optimize-contrast;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Kaydırma Çubuğu Tasarımı */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.3); }

        /* SAĞ TIK MENÜSÜ */
        #contextMenu {
            position: fixed; display: none; min-width: 220px;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4); z-index: 2147483647;
            padding: 8px;
            animation: menuFade 0.15s ease-out;
        }
        @keyframes menuFade { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        .context-item {
            padding: 12px 16px; display: flex; align-items: center; gap: 12px;
            font-size: 13px; font-weight: 600; color: #1e293b;
            border-radius: 14px; cursor: pointer; transition: all 0.2s;
        }
        .context-item:hover { background: rgba(37, 99, 235, 0.1); color: #2563eb; }
        .context-divider { height: 1px; background: rgba(0,0,0,0.06); margin: 6px 4px; }

        /* KAPILAR / MODALLAR */
        .gate-backdrop {
            position: fixed; inset: 0; z-index: 10000005;
            background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(12px);
            display: none; flex-direction: column; align-items: center;
            justify-content: center; text-align: center; padding: 20px;
            transition: opacity 0.4s ease;
        }
        .welcome-card {
            background: rgba(255, 255, 255, 0.98); padding: 45px; border-radius: 40px;
            box-shadow: 0 35px 70px rgba(0,0,0,0.2); max-width: 600px; width: 100%;
            animation: welcomePop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes welcomePop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* MASAÜSTÜ */
        .desktop {
            height: 100vh; width: 100vw;
            background-size: cover; background-position: center;
            position: relative; display: none;
            transition: background-image 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #ui-wrapper {
            width: 100%; height: 100%;
            transform: scale(var(--ui-scale));
            transform-origin: center center;
            display: flex; flex-direction: column;
            position: relative;
            backface-visibility: hidden;
            pointer-events: none;
        }
        
        #ui-wrapper > * { pointer-events: auto; }

        /* GLASS EFEKTİ */
        .glass {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(20px) saturate(140%);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1);
            transform: translateZ(0);
            will-change: backdrop-filter, transform;
        }

        /* WIDGET STİLLERİ */
        .widget {
            position: absolute; border-radius: 28px;
            padding: 24px; min-width: 200px;
            cursor: move; transition: transform 0.2s, box-shadow 0.2s;
            z-index: 50;
            border: 1px solid rgba(255,255,255,0.4);
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        .widget:hover { transform: scale(1.02) translateZ(0); box-shadow: 0 15px 35px rgba(0,0,0,0.2); }
        .widget-close { position: absolute; top: 12px; right: 12px; width: 22px; height: 22px; border-radius: 50%; background: rgba(0,0,0,0.08); display: none; align-items: center; justify-content: center; cursor: pointer; color: #1e293b; font-weight: bold; }
        .widget:hover .widget-close { display: flex; }

        /* PENCERE ANİMASYONLARI */
        .window {
            position: absolute; min-width: 320px; min-height: 200px;
            border-radius: 24px; overflow: hidden; display: flex;
            flex-direction: column; z-index: 100;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            transition: opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1), transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            animation: winOpen 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-origin: center center;
            will-change: transform, opacity;
        }

        @keyframes winOpen {
            from { opacity: 0; transform: scale(0.85) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .window.closing { opacity: 0; transform: scale(0.85) translateY(20px); pointer-events: none; }
        .window.minimized { opacity: 0; transform: scale(0.5) translateY(100px); pointer-events: none; }

        .window-header {
            cursor: move; padding: 14px 20px; background: rgba(255, 255, 255, 0.85);
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05); user-select: none;
        }

        .window-content {
            flex-grow: 1; background: rgba(255, 255, 255, 0.96);
            color: #1e293b; overflow: hidden; display: flex;
            flex-direction: column; position: relative;
        }

        /* DOCK - PINNED TO BOTTOM */
        .status-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            width: 100%; height: 52px; 
            background: #ffffff; 
            display: flex; flex-direction: row; align-items: center;
            padding: 0 18px; gap: 10px; z-index: 999999;
            border-top: 1px solid rgba(0,0,0,0.08); 
            will-change: transform;
            box-shadow: 0 -5px 25px rgba(0,0,0,0.08);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
        }

        .status-bar.dock-hidden { transform: translateY(100%); opacity: 0; pointer-events: none; }

        /* BAŞLAT MENÜSÜ */
        .start-menu {
            position: absolute; bottom: 62px; left: 50%; 
            transform: translateX(-50%) translateZ(0); 
            width: 90%; max-width: 850px; height: 480px;
            background: rgba(255, 255, 255, 0.92); backdrop-filter: blur(40px);
            display: none; flex-direction: column;
            padding: 30px; z-index: 1000000;
            border-radius: 36px; border: 1px solid rgba(255,255,255,0.6);
            box-shadow: 0 40px 100px rgba(0,0,0,0.3);
            animation: startPop 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes startPop { 
            from { opacity: 0; transform: translateX(-50%) translateY(20px); } 
            to { opacity: 1; transform: translateX(-50%) translateY(0); } 
        }

        .app-list {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 15px; flex-grow: 1; overflow-y: auto; margin-top: 20px;
            padding-right: 10px; justify-items: center; align-content: start;
        }

        .launch-item {
            display: flex; flex-direction: column; align-items: center;
            gap: 10px; cursor: pointer; padding: 18px 10px;
            width: 100px; border-radius: 22px;
            transition: background 0.3s ease, border-color 0.3s ease;
            border: 1px solid transparent;
        }
        .launch-item:hover { background: rgba(59, 130, 246, 0.08); border-color: rgba(59, 130, 246, 0.15); }

        .launch-icon {
            width: 52px; height: 52px; border-radius: 14px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1); pointer-events: none;
            border: 1px solid rgba(255, 255, 255, 0.4); flex-shrink: 0;
        }
        .launch-label { font-size: 12px; font-weight: 700; color: #334155; text-align: center; }

        /* TASKBAR İKONLARI */
        .task-item { 
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; 
            border-radius: 12px; background: transparent; cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: none; flex-shrink: 0; 
        }
        .task-item:hover { transform: scale(1.15) translateY(-5px); }
        .task-item.active-win { background: rgba(0,0,0,0.03); }
        .task-item-inner { 
            width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; 
            pointer-events: none; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .sidebar-nav { width: 230px; background: rgba(0, 0, 0, 0.02); border-right: 1px solid rgba(0, 0, 0, 0.06); padding: 24px 0; flex-shrink: 0; }
        .tab-btn { width: 100%; text-align: left; padding: 14px 28px; font-size: 14px; font-weight: 700; color: #64748b; transition: all 0.2s; border-left: 4px solid transparent; cursor: pointer; }
        .tab-btn.active { color: #2563eb; background: rgba(37, 99, 235, 0.08); border-left-color: #2563eb; }
        
        .search-input { 
            width: 100%; background: rgba(0, 0, 0, 0.05); border: 1px solid rgba(0, 0, 0, 0.05); 
            border-radius: 18px; padding: 14px 20px; color: #1e293b; outline: none; font-size: 14px; transition: all 0.2s;
        }
        .search-input:focus { background: white; border-color: #3b82f6; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.15); }

        .dock-right { margin-left: auto; display: flex; align-items: center; gap: 4px; }
        .clock-container { display: flex; align-items: center; gap: 4px; color: #0f172a; font-size: 14px; font-weight: 700; cursor: pointer; padding: 6px 12px; border-radius: 14px; transition: background 0.2s; }
        .clock-container:hover { background: rgba(0, 0, 0, 0.05); }

        /* SÜRGÜ TASARIMI */
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 6px; border-radius: 10px; outline: none; background: #e2e8f0; }
        input[type="range"]::-webkit-slider-thumb { 
            -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; 
            background: #ffffff; border: 3px solid #3b82f6; cursor: pointer; box-shadow: 0 3px 8px rgba(0,0,0,0.15); 
        }

        /* BOOT, LOGIN & SETUP */
        .boot-screen { position: fixed; inset: 0; background: #f8fafc; z-index: 2000000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s ease; }
        .login-screen { position: fixed; inset: 0; background-image: url('https://filedn.eu/liPnBWWQgeQVeGgdPoPnl8S/edmorosstockwall.jpg'); background-size: cover; z-index: 1999999; display: none; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s ease; }
        .setup-screen { position: fixed; inset: 0; background: linear-gradient(135deg, #f8fafc 0%, #cbd5e1 100%); z-index: 1999998; display: none; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s ease; }
        
        .setup-card { background: rgba(255, 255, 255, 0.95); padding: 40px; border-radius: 40px; box-shadow: 0 25px 60px rgba(0,0,0,0.1); max-width: 450px; width: 90%; text-align: left; }
        .setup-input { width: 100%; background: #f1f5f9; border: 1px solid #e2e8f0; padding: 12px 18px; border-radius: 16px; margin-top: 8px; outline: none; font-weight: 600; color: #1e293b; }
        .setup-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }

        /* MAĞAZA BUTONLARI */
        .store-item { background: white; border: 1px solid rgba(0,0,0,0.06); border-radius: 24px; padding: 20px; display: flex; align-items: center; gap: 16px; margin-bottom: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); width: 100%; transition: all 0.3s; }
        .install-btn { background: #10b981; color: white; padding: 10px 24px; border-radius: 24px; font-size: 12px; font-weight: 800; cursor: pointer; flex-shrink: 0; transition: all 0.2s; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.2); }
        .install-btn:hover { background: #059669; }
        .install-btn.installed { background: #047857; pointer-events: none; opacity: 0.8; box-shadow: none; }
        .install-btn.loading { background: #f1f5f9; color: #10b981; cursor: wait; border: 1px solid #10b981; }

        /* TAKVİM */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; text-align: center; width: 100%; }
        .calendar-day-name { font-weight: 800; font-size: 12px; color: #3b82f6; padding: 10px 0; }
        .calendar-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; border-radius: 12px; color: #334155; cursor: pointer; transition: all 0.2s; position: relative; }
        .calendar-day:hover { background: rgba(59, 130, 246, 0.1); }
        .calendar-day.today { background: #3b82f6; color: white; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4); }
        .calendar-day.selected { border: 2px solid #3b82f6; }
        .calendar-event-dot { width: 4px; height: 4px; background: #3b82f6; border-radius: 50%; position: absolute; bottom: 6px; }

        /* SES POPUP */
        #volumePopup {
            position: absolute; bottom: 62px; left: 50%; width: 240px; background: white; 
            border: 1px solid rgba(0,0,0,0.1); border-radius: 24px; padding: 24px;
            display: none; flex-direction: column; gap: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            z-index: 1000000; animation: startPop 0.2s ease-out;
        }

        /* WIFI POPUP */
        #wifiPopup {
            position: absolute; bottom: 62px; left: 50%; width: 280px; background: white; 
            border: 1px solid rgba(0,0,0,0.1); border-radius: 24px; padding: 20px;
            display: none; flex-direction: column; gap: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            z-index: 1000000; animation: startPop 0.2s ease-out;
        }
        .wifi-list-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 14px; border-radius: 16px; cursor: pointer;
            transition: all 0.2s; border: 1px solid transparent;
        }
        .wifi-list-item:hover { background: rgba(59, 130, 246, 0.05); border-color: rgba(59, 130, 246, 0.1); }
        .wifi-name { color: #000000; font-weight: 700; font-size: 13px; }
        .wifi-signal-bars { display: flex; align-items: flex-end; gap: 2px; height: 14px; }
        .wifi-bar { width: 3px; background: #e2e8f0; border-radius: 1px; }
        .wifi-bar.active { background: #2563eb; }

        /* KISAYOL TUŞU TASARIMI */
        .kbd-key {
            background: #f1f5f9; border: 1px solid #cbd5e1; border-radius: 6px;
            padding: 2px 8px; font-family: monospace; font-weight: 800;
            color: #334155; box-shadow: 0 2px 0 #cbd5e1; font-size: 12px;
        }

        .spinner { border: 2px solid rgba(59, 130, 246, 0.1); border-top: 2px solid #3b82f6; border-radius: 50%; width: 14px; height: 14px; animation: spin 0.8s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* AGREEMENT SCREEN STYLES */
        .agreement-box {
            height: 250px; overflow-y: auto; background: #f8fafc; border: 1px solid #e2e8f0;
            border-radius: 20px; padding: 20px; font-size: 12px; line-height: 1.6; color: #475569;
            margin-bottom: 20px;
        }

        /* BROWSER STYLES */
        .browser-tab {
            padding: 8px 16px; font-size: 11px; font-weight: 700; color: #64748b;
            background: rgba(0,0,0,0.03); border-radius: 12px 12px 0 0; cursor: pointer;
            display: flex; align-items: center; gap: 8px; border: 1px solid transparent;
            border-bottom: none; transition: all 0.2s; max-width: 150px;
        }
        .browser-tab.active { background: white; color: #2563eb; border-color: rgba(0,0,0,0.05); }
        .browser-tab:hover:not(.active) { background: rgba(0,0,0,0.06); }
    </style>
</head>
<body>

    <div id="contextMenu">
        <div class="context-item" onclick="window.openApp('notepad')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
            <span>Yeni Not Oluştur</span>
        </div>
        <div class="context-item" onclick="window.openAppSettings()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            <span>Uygulamalar</span>
        </div>
        <div class="context-divider"></div>
        <div class="context-item" onclick="window.openApp('settings')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1 2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1-2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            <span>Sistem Ayarları</span>
        </div>
    </div>

    <div id="welcomeGate" class="gate-backdrop">
        <div class="welcome-card text-center text-slate-800">
            <h1 class="text-2xl font-black mb-6 tracking-tight uppercase text-slate-900 text-center">EdmorOs'a Hoş Geldiniz</h1>
            <div class="text-slate-600 font-medium leading-relaxed text-sm text-left space-y-4 px-6">
                <p>EdmorOs deneyimine hoş geldiniz. Size bir kaç önemli hatırlatma yapmak istiyoruz. EdmorOs bir web tabanlı işletim sistemidir. Yaptığınız tüm değişiklikler tarayıcı diskinizde saklanır.</p>
                <p>Tarayıcı önbelleğini silmeniz durumunda verileriniz kalıcı olarak silinir.</p>
                <p>Tam ekran modu (F11) en iyi deneyimi sunar.</p>
            </div>
            <button class="mt-10 bg-blue-600 text-white w-full py-4 rounded-2xl font-bold hover:bg-blue-700 transition-all uppercase tracking-widest text-xs shadow-lg" onclick="window.closeWelcome()">Anlaşıldı, Başla</button>
        </div>
    </div>

    <div id="bootScreen" class="boot-screen">
        <svg viewBox="0 0 300 80" class="w-80 mb-10 animate-pulse font-black italic tracking-widest text-5xl">
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle">
                <tspan fill="#eab308">Edmor</tspan><tspan fill="#3b82f6">Os</tspan>
            </text>
        </svg>
        <div id="bootProgress" class="w-72 h-1.5 bg-slate-200 rounded-full overflow-hidden mb-5">
            <div id="bootBar" class="h-full bg-blue-600 w-0 transition-all duration-300"></div>
        </div>
        <div id="bootStatus" class="text-xs text-slate-500 font-bold tracking-[0.2em] uppercase text-center px-10">Sistem Hazırlanıyor...</div>
    </div>

    <div id="setupScreen" class="setup-screen">
        <div class="setup-card">
            <h1 class="text-2xl font-black text-slate-900 mb-2">EdmorOs Kurulumu</h1>
            <p class="text-xs text-slate-500 font-bold uppercase tracking-widest">v1.0.0.1 Public Beta</p>
            
            <div class="space-y-6">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Kullanıcı Adı</label>
                    <input type="text" id="setupUsername" placeholder="Adınızı girin..." class="setup-input">
                </div>
                
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Bölge</label>
                    <select id="setupRegion" class="setup-input">
                        <option value="tr">Türkiye</option>
                        <option value="az">Azerbaycan</option>
                        <option value="kktc">KKTC</option>
                        <option value="eu">Avrupa</option>
                    </select>
                </div>

                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Sistem Dili</label>
                    <select id="setupLang" class="setup-input opacity-60 cursor-not-allowed" disabled>
                        <option value="tr">Türkçe (Varsayılan)</option>
                    </select>
                </div>

                <button onclick="window.completeSetup()" class="w-full mt-8 bg-blue-600 text-white py-4 rounded-2xl font-black text-xs uppercase shadow-lg hover:bg-blue-700 transition-all active:scale-95">Kurulumu Tamamla</button>
            </div>
        </div>
    </div>

    <div id="agreementScreen" class="setup-screen" style="display: none;">
        <div class="setup-card max-w-[550px]">
            <h1 class="text-2xl font-black text-slate-900 mb-2">Kullanıcı Sözleşmesi</h1>
            <p class="text-xs text-slate-500 font-bold uppercase tracking-widest mb-6">Yasal Bildirimler ve Şartlar</p>
            
            <div class="agreement-box scrollbar-thin">
                <p class="font-bold mb-2">1. Genel Şartlar</p>
                EdmorOs, Linux çekirdeği üzerine inşa edilmiş web tabanlı bir işletim sistemidir. Bu sistemi kullanarak tüm yerel depolama risklerini kabul etmiş sayılırsınız. Verileriniz sunucularımızda değil, yalnızca tarayıcınızın "LocalStorage" alanında saklanır. Tarayıcı verilerini temizlemeniz durumunda veriler geri döndürülemez şekilde silinecektir.
                
                <p class="font-bold mt-4 mb-2">2. Gizlilik ve Veri Güvenliği</p>
                Sistem, kişisel verilerinizi toplamaz, işlemez veya üçüncü taraflarla paylaşmaz. Tüm işlemler istemci tarafında (Client-side) gerçekleşir.
                
                <p class="font-bold mt-4 mb-2">3. Lisans ve Kullanım</p>
                EdmorOs "Olduğu Gibi" (As-Is) sunulmaktadır. Yazılımdaki hatalardan veya veri kayıplarından geliştirici ekip sorumlu tutulamaz. Yazılımın kopyalanması veya kötüye kullanımı durumunda erişim engellenebilir.
                
                <p class="font-bold mt-4 mb-2">4. Beta Bildirimi</p>
                Bu sürüm bir "Public Beta" aşamasındadır. Sistemin kararlı çalışması garanti edilmemektedir.
            </div>

            <div class="flex items-start gap-3 mb-8">
                <input type="checkbox" id="agreeCheck" class="mt-1 w-5 h-5 cursor-pointer accent-blue-600" onchange="window.toggleAgreementBtn()">
                <label for="agreeCheck" class="text-xs font-semibold text-slate-600 leading-tight cursor-pointer">
                    EdmorOs Kullanıcı Sözleşmesini okudum, anladım ve sistemin tarayıcı verilerim üzerinde işlem yapmasını onaylıyorum.
                </label>
            </div>

            <button id="agreementNextBtn" onclick="window.completeAgreement()" disabled class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black text-xs uppercase shadow-lg hover:bg-blue-700 transition-all active:scale-95 opacity-40 cursor-not-allowed">Sistemi Başlat</button>
        </div>
    </div>

    <div id="loginScreen" class="login-screen">
        <div class="login-card glass text-center p-12 rounded-[40px] w-[360px]">
            <div class="w-28 h-28 bg-white/50 rounded-full mx-auto mb-8 flex items-center justify-center border-4 border-white shadow-xl overflow-hidden">
                <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="#1e293b" stroke-width="1.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
            </div>
            <h2 id="loginDisplayUser" class="text-3xl font-black text-slate-900 mb-2 tracking-tight text-center">Admin</h2>
            <p class="text-[10px] text-slate-500 mb-10 font-bold uppercase tracking-widest text-center">Sistem Yöneticisi</p>
            <button class="bg-blue-600 text-white w-full py-5 rounded-[22px] font-black text-sm uppercase hover:bg-blue-700 shadow-2xl transition-all active:scale-95" onclick="window.performLogin()">Giriş Yap</button>
        </div>
        <div class="absolute bottom-10 text-white/50 text-[10px] font-bold tracking-[0.3em] uppercase">v1.0.0.1 Public Beta</div>
    </div>

    <div class="desktop" id="desktop">
        <div id="widgetContainer" class="absolute inset-0 pointer-events-none z-40"></div>
        <div id="ui-wrapper">
        </div>
        
        <div class="status-bar" id="mainDock">
            <div id="startMenu" class="start-menu" onclick="event.stopPropagation()">
                <div class="mb-4"><input type="text" class="search-input" placeholder="Uygulama ara..." id="menuSearch" oninput="window.filterApps()"></div>
                <div class="app-list" id="appGrid"></div>
            </div>
            <button id="startButton" onclick="window.toggleStartMenu()" class="h-10 w-10 flex items-center justify-center rounded-full bg-blue-600 hover:bg-blue-500 shadow-lg transition-all transform hover:scale-110 active:scale-95 z-[1000001]">
                <span class="font-bold italic text-white text-lg">E</span>
            </button>
            <div id="activeApps" class="flex flex-row items-center gap-3 h-full overflow-x-auto px-2 scrollbar-none" style="scrollbar-width: none;"></div>
            <div class="dock-right">
                <div class="relative">
                    <div class="p-3 cursor-pointer opacity-90 hover:opacity-100 transition-all flex items-center" onclick="window.toggleVolumePopup()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#0f172a" stroke-width="2.5"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                    </div>
                    <div id="volumePopup" class="absolute bottom-[60px] left-1/2 -translate-x-1/2 w-[240px] p-6 bg-white border border-slate-200 rounded-3xl hidden flex-col gap-3 shadow-2xl">
                        <div class="flex justify-between items-center text-slate-800 p-1"><span class="text-[11px] font-black uppercase">Ses</span><span id="volumeValue" class="text-xs text-blue-600 font-bold font-mono">75%</span></div>
                        <input type="range" id="volSlider" class="volume-slider appearance-none" min="0" max="100" value="75" oninput="window.updateVolume(this.value)">
                    </div>
                </div>
                <div class="relative">
                    <div class="p-3 cursor-pointer opacity-90 hover:opacity-100 transition-all flex items-center" onclick="window.toggleWifiPopup()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#0f172a" stroke-width="2.5"><path d="M5 12.55a11 11 0 0 1 14.08 0"></path><path d="M1.42 9a16 16 0 0 1 21.16 0"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path><line x1="12" y1="20" x2="12.01" y2="20"></line></svg>
                    </div>
                    <div id="wifiPopup" class="absolute bottom-[60px] left-1/2 -translate-x-1/2 w-[280px] p-5 bg-white border border-slate-200 rounded-[32px] hidden flex-col gap-2 shadow-2xl">
                        <div class="flex justify-between items-center px-2 mb-2">
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Wi-Fi Ağları</span>
                            <span class="spinner w-3 h-3"></span>
                        </div>
                        <div id="wifiList" class="flex flex-col gap-1 max-h-[300px] overflow-y-auto pr-1">
                            </div>
                    </div>
                </div>
                <div id="clock" class="clock-container ml-1" onclick="window.openApp('calendar')">
                    <span id="clock-h" class="text-slate-900">00</span><span class="opacity-50 mx-0.5 text-slate-400">:</span><span id="clock-m" class="text-slate-900">00</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'edmor_os_data_v1';
        const SYSTEM_VERSION = "v1.0.0.1 Public Beta";
        let zIndexCounter = 1000;
        let installingApps = {};
        let taskManagerInterval = null;
        let activeStoreTab = 'media';
        let systemData = { 
            installed_apps: [], notepad_content: "", setup_complete: false, 
            agreement_accepted: false,
            username: "Admin", ui_scale: 0.8, font_size: 16,
            wallpaper: "https://filedn.eu/liPnBWWQgeQVeGgdPoPnl8S/edmorosstockwall.jpg",
            widgets: [], calendar_events: {}, notes: []
        };
        let calState = { month: new Date().getMonth(), year: new Date().getFullYear() };
        window.browserTabs = {};

        const SYSTEM_APPS = {
            weather: { id: 'weather', title: 'Hava Durumu', icon: 'bg-white border border-slate-200', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#0f172a" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 19c2.5 0 4.5-2 4.5-4.5 0-2.3-1.7-4.2-3.9-4.5C17.6 6.6 14.6 4 11 4 7.9 4 5.2 6.1 4.2 9 2.1 9.6 1 11.6 1 14c0 2.8 2.2 5 5 5h11.5z"></path></svg>' },
            calculator: { id: 'calculator', title: 'Hesap Makinesi', icon: 'bg-orange-500', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="14"></line><line x1="8" y1="10" x2="8" y2="10"></line><line x1="12" y1="10" x2="12" y2="10"></line><line x1="16" y1="10" x2="16" y2="10"></line><line x1="8" y1="14" x2="8" y2="14"></line><line x1="12" y1="14" x2="12" y2="14"></line><line x1="8" y1="18" x2="8" y2="18"></line><line x1="12" y1="18" x2="12" y2="18"></line><line x1="16" y1="18" x2="16" y2="18"></line></svg>' },
            shortcuts: { id: 'shortcuts', title: 'Kısayollar', icon: 'bg-blue-500', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="16" rx="2" ry="2"></rect><path d="M7 8h10M7 12h10M7 16h10"></path></svg>' },
            file_manager: { id: 'file_manager', title: 'Dosya Yöneticisi', icon: 'bg-yellow-500', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>' },
            package_installer: { id: 'package_installer', title: 'Paket Yükleyicisi', icon: 'bg-emerald-600', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>' },
            dizipal: { id: 'dizipal', title: 'Dizipal', icon: 'bg-black', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="10 8 16 12 10 16 10 8"></polygon></svg>' },
            task_manager: { id: 'task_manager', title: 'Görev Yöneticisi', icon: 'bg-slate-700', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>' },
            terminal: { id: 'terminal', title: 'Terminal', icon: 'bg-zinc-800', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></svg>' },
            notepad: { id: 'notepad', title: 'Not Defteri', icon: 'bg-blue-600', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>' },
            music: { id: 'music', title: 'Edmor Music', icon: 'bg-purple-600', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>' },
            calendar: { id: 'calendar', title: 'Takvim', icon: 'bg-rose-600', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>' },
            store: { id: 'store', title: 'Mağaza', icon: 'bg-indigo-600', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path><path d="M3 6h18"></path><path d="M16 10a4 4 0 0 1-8 0"></path></svg>' },
            settings: { id: 'settings', title: 'Ayarlar', icon: 'bg-slate-500', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>' },
            about: { id: 'about', title: 'EdmorOs Hakkında', icon: 'bg-indigo-500', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>' },
            pdf_reader: { id: 'pdf_reader', title: 'PDF Okuyucu', icon: 'bg-red-500', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="M9 15h3a1 1 0 0 1 0 2H9v-2z"></path><path d="M15 15h-3v4"></path></svg>' },
            edmor_browser: { id: 'edmor_browser', title: 'Edmor Browser', icon: 'bg-blue-400', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>' },
            tools_addon: { id: 'tools_addon', title: 'Araçlar Eklentisi', icon: 'bg-cyan-500', svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>' }
        };

        const STORE_APPS = {
            youtube: { 
                id: 'youtube', title: 'Youtube', category: 'media', icon: 'bg-red-600', 
                svg: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19.1c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2c.46-1.7.46-5.33.46-5.33s0-3.63-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02" fill="white"></polygon></svg>', 
                size: 88, speed: 2.5 
            }
        };

        // --- CORE FUNCTIONS ---
        function fetchWithBackoff(url, options = {}, retries = 5, delay = 1000) {
            return fetch(url, options).then(res => { if(!res.ok) throw new Error(); return res.json(); })
                .catch(err => { if(retries === 0) throw err; return new Promise(r => setTimeout(r, delay)).then(() => fetchWithBackoff(url, options, retries - 1, delay * 2)); });
        }

        window.getLiveLocation = async function() {
            return new Promise((resolve) => {
                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        (pos) => resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude }),
                        async () => { try { const resp = await fetch('https://ipapi.co/json/'); const data = await resp.json(); resolve({ lat: data.latitude, lon: data.longitude, city: data.city }); } catch (e) { resolve(null); } },
                        { timeout: 5000 }
                    );
                } else resolve(null);
            });
        };

        window.checkDockOverlap = function() {
            const dock = document.getElementById('mainDock'); if(!dock) return;
            const windows = document.querySelectorAll('.window:not(.minimized):not(.hidden)');
            const dockRect = dock.getBoundingClientRect();
            let overlap = Array.from(windows).some(win => { const r = win.getBoundingClientRect(); return r.bottom > dockRect.top - 10 && r.right > dockRect.left && r.left < dockRect.right; });
            overlap ? dock.classList.add('dock-hidden') : dock.classList.remove('dock-hidden');
        };

        function getStorageInfo() {
            try {
                const dataStr = localStorage.getItem(STORAGE_KEY) || "";
                const usedMB = (new TextEncoder().encode(dataStr).length / (1024 * 1024)).toFixed(2);
                return { used: usedMB, remaining: (5120 - usedMB).toFixed(2), percent: Math.max((usedMB / 5120) * 100, 0.5) };
            } catch(e) { return { used: "0", remaining: "5120", percent: 0 }; }
        }

        window.syncToDisk = function() { localStorage.setItem(STORAGE_KEY, JSON.stringify(systemData)); window.renderLaunchpad(); };

        window.loadSystemData = function() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    systemData = Object.assign(systemData, JSON.parse(saved));
                    if (!systemData.notes) systemData.notes = [];
                    if (systemData.agreement_accepted === undefined) systemData.agreement_accepted = false;
                }
            } catch(e) { systemData.notes = []; }
            window.applyVisuals();
        };

        window.applyVisuals = function() {
            const root = document.documentElement;
            root.style.setProperty('--base-font-size', (systemData.font_size || 16) + 'px');
            root.style.setProperty('--ui-scale', systemData.ui_scale || 0.8);
            const d = document.getElementById('desktop'); if (d) d.style.backgroundImage = `url(${systemData.wallpaper})`;
            window.updateSliderGradients();
        };

        window.updateSliderGradients = function() {
            document.querySelectorAll('input[type="range"]').forEach(s => {
                const p = ((s.value - s.min) / (s.max - s.min)) * 100;
                s.style.background = `linear-gradient(to right, #3b82f6 0%, #3b82f6 ${p}%, #e2e8f0 ${p}%, #e2e8f0 100%)`;
            });
        };

        window.renderLaunchpad = function() { 
            const grid = document.getElementById('appGrid'); if(!grid) return;
            grid.innerHTML = ""; 
            Object.values(SYSTEM_APPS).forEach(a => grid.appendChild(window.createLaunchItem(a))); 
            systemData.installed_apps.forEach(id => { if(STORE_APPS[id]) grid.appendChild(window.createLaunchItem(STORE_APPS[id])); }); 
        };

        window.createLaunchItem = function(app) { 
            const div = document.createElement('div'); div.className = "launch-item"; div.onclick = () => window.openApp(app.id); 
            div.innerHTML = `<div class="launch-icon ${app.icon}">${app.svg}</div><span class="launch-label font-bold text-slate-800 text-xs mt-1 text-center">${app.title}</span>`; 
            return div; 
        };

        window.openApp = function(id) {
            try {
                if(document.getElementById(`startMenu`).style.display === 'flex') window.toggleStartMenu();
                if(document.getElementById(`window-${id}`)) { window.focusWindow(document.getElementById(`window-${id}`)); return; }
                const win = document.createElement('div');
                win.id = `window-${id}`; win.className = 'window glass';
                win.style.left = (120 + Math.random() * 80) + 'px'; win.style.top = (80 + Math.random() * 60) + 'px';
                win.style.zIndex = ++zIndexCounter;
                const sizes = { settings: {w: '800px', h: '550px'}, store: {w: '820px', h: '580px'}, terminal: {w: '600px', h: '400px'}, music: {w: '950px', h: '650px'}, calendar: {w: '400px', h: '620px'}, notepad: {w: '600px', h: '450px'}, youtube: {w: '950px', h: '650px'}, task_manager: {w: '450px', h: '500px'}, dizipal: {w: '1050px', h: '700px'}, weather: {w: '400px', h: '550px'}, calculator: {w: '320px', h: '480px'}, shortcuts: {w: '500px', h: '600px'}, about: {w: '550px', h: '620px'}, pdf_reader: {w: '900px', h: '700px'}, edmor_browser: {w: '1000px', h: '700px'}, file_manager: {w: '850px', h: '550px'}, package_installer: {w: '420px', h: '500px'} };
                const s = sizes[id] || {w: '500px', h: '400px'}; win.style.width = s.w; win.style.height = s.h;
                const appData = SYSTEM_APPS[id] || STORE_APPS[id];
                win.innerHTML = `<div class="window-header" onmousedown="window.dragWindow(event, this.parentElement)">
                    <span class="text-[11px] font-bold text-slate-700 opacity-80 uppercase tracking-widest">${appData.title}</span>
                    <div class="flex gap-2">
                        <button onclick="window.minimizeWindow('${id}')" class="w-6 h-6 flex items-center justify-center bg-gray-200 hover:bg-gray-300 rounded text-slate-600 font-bold transition-colors pb-1">-</button>
                        <button onclick="window.closeWindow('${id}')" class="w-6 h-6 flex items-center justify-center bg-red-500 hover:bg-red-600 rounded text-white font-bold transition-colors pb-0.5">x</button>
                    </div>
                </div><div class="window-content" id="win-content-${id}"></div><div class="resizer absolute bottom-0 right-0 w-4 h-4 cursor-nwse-resize z-10" onmousedown="window.initResize(event, this.parentElement)"></div>`;
                document.getElementById('ui-wrapper').appendChild(win);
                window.renderAppContent(id); window.addTaskItem(id, appData.title); window.checkDockOverlap();
            } catch(e) { console.error(e); }
        };

        window.focusWindow = function(win) {
            zIndexCounter++; win.style.zIndex = zIndexCounter; win.classList.remove('hidden', 'minimized');
            document.querySelectorAll('.task-item').forEach(t => t.classList.remove('active-win'));
            const task = document.getElementById(`task-item-${win.id.replace('window-', '')}`); if(task) task.classList.add('active-win');
            window.checkDockOverlap();
        };

        window.addTaskItem = function(id, title) {
            if(document.getElementById(`task-item-${id}`)) return;
            const app = SYSTEM_APPS[id] || STORE_APPS[id];
            const div = document.createElement('div'); div.id = `task-item-${id}`; div.className = "task-item active-win";
            div.innerHTML = `<div class="task-item-inner ${app.icon}">${app.svg}</div>`;
            div.onclick = () => window.minimizeWindow(id);
            document.getElementById('activeApps').appendChild(div);
        };

        window.minimizeWindow = function(id) { 
            const win = document.getElementById(`window-${id}`); const t = document.getElementById(`task-item-${id}`);
            if(!win) return;
            if(win.classList.contains('minimized') || win.classList.contains('hidden')) { window.focusWindow(win); } 
            else { win.classList.add('minimized'); t.classList.remove('active-win'); setTimeout(() => win.classList.add('hidden'), 250); }
            window.checkDockOverlap();
        };

        window.closeWindow = function(id) { 
            const win = document.getElementById(`window-${id}`); if(win) { win.classList.add('closing'); if(id==='task_manager') clearInterval(taskManagerInterval); setTimeout(() => { win.remove(); document.getElementById(`task-item-${id}`)?.remove(); window.checkDockOverlap(); }, 250); }
        };

        window.dragWindow = function(e, win) { 
            if(['BUTTON', 'INPUT', 'TEXTAREA'].includes(e.target.tagName)) return; window.focusWindow(win); 
            let p1=0, p2=0, p3=e.clientX, p4=e.clientY; 
            document.onmousemove = (ev) => { p1 = p3 - ev.clientX; p2 = p4 - ev.clientY; p3 = ev.clientX; p4 = ev.clientY; win.style.top = (win.offsetTop - p2) + "px"; win.style.left = (win.offsetLeft - p1) + "px"; };
            document.onmouseup = () => { document.onmousemove = null; window.checkDockOverlap(); }; 
        };

        window.initResize = function(e, win) { 
            e.preventDefault(); let sW = win.offsetWidth, sH = win.offsetHeight, sX = e.clientX, sY = e.clientY; 
            document.onmousemove = (ev) => { win.style.width = Math.max(320, sW + (ev.clientX - sX)) + "px"; win.style.height = Math.max(200, sH + (ev.clientY - sY)) + "px"; window.checkDockOverlap(); };
            document.onmouseup = () => { document.onmousemove = null; }; 
        };

        // --- YOUTUBE CACHE CLEAR LOGIC ---
        async function clearYouTubeCache() {
            if (typeof chrome !== 'undefined' && chrome.browsingData) {
                await chrome.browsingData.remove({
                    "origins": ["https://www.youtube.com"]
                }, {
                    "serviceWorkers": true,
                    "cacheStorage": true
                });
            }
        }

        // --- APP RENDERERS ---
        window.renderAppContent = function(id) {
            const cont = document.getElementById(`win-content-${id}`); if(!cont) return;
            const timestamp = new Date().getTime(); 

            if(id === 'notepad') window.renderNotepadApp(id);
            else if(id === 'weather') window.renderWeatherApp(id);
            else if(id === 'calculator') window.renderCalculatorApp(id);
            else if(id === 'shortcuts') window.renderShortcutsApp(id);
            else if(id === 'task_manager') window.renderTaskManager(id);
            else if(id === 'settings') window.renderSettingsApp(id);
            else if(id === 'about') window.renderAboutApp(id);
            else if(id === 'pdf_reader') window.renderPDFReader(id);
            else if(id === 'edmor_browser') window.renderEdmorBrowser(id);
            else if(id === 'file_manager') window.renderFileManager(id);
            else if(id === 'package_installer') window.renderPackageInstaller(id);
            else if(id === 'store') cont.innerHTML = window.generateStoreHTML();
            else if(id === 'calendar') cont.innerHTML = window.generateCalendarHTML();
            else if(id === 'terminal') cont.innerHTML = `<div class="p-5 font-mono text-sm h-full bg-white text-blue-700">root@edmor:~$ <br><br>Kernel: Edmor-X v6.4.2<br>Sürüm: ${SYSTEM_VERSION}<br>Ready.</div>`;
            else if(id === 'music') cont.innerHTML = `<iframe src="https://edmorstream.com.tr?v=${timestamp}" class="w-full h-full border-none"></iframe>`;
            else if(id === 'dizipal') cont.innerHTML = `<iframe src="https://dizipal1530.com/?v=${timestamp}" referrerpolicy="no-referrer" class="w-full h-full border-none bg-black"></iframe>`;
            else if(id === 'youtube') {
                const iframeId = `youtube-iframe-${timestamp}`;
                cont.innerHTML = `
                <div class="flex flex-col h-full bg-black">
                    <div class="flex items-center justify-between px-6 py-3 bg-zinc-900 border-b border-zinc-800">
                        <span class="text-[10px] text-zinc-400 font-bold uppercase tracking-widest">YouTube Desktop</span>
                        <button onclick="window.open('https://www.youtube.com', '_blank')" class="text-[10px] bg-red-600 hover:bg-red-500 text-white px-3 py-1 rounded-full font-black transition-all">DIŞARIDA AÇ</button>
                    </div>
                    <iframe id="${iframeId}" class="flex-grow border-none" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>
                </div>`;
                
                clearYouTubeCache().then(() => {
                    const iframe = document.getElementById(iframeId);
                    if(iframe) iframe.src = "https://www.youtube.com";
                }).catch(() => {
                    const iframe = document.getElementById(iframeId);
                    if(iframe) iframe.src = "https://www.youtube.com";
                });
            }
            else if(id === 'tools_addon') {
                cont.innerHTML = `
                <div class="flex flex-col h-full bg-white p-8">
                    <h2 class="text-2xl font-black text-slate-900 mb-6">Masaüstü Araçları</h2>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-6 bg-slate-50 rounded-3xl border border-slate-100">
                            <div class="flex items-center gap-4">
                                <div class="w-14 h-14 bg-gradient-to-br from-cyan-400 to-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                                </div>
                                <div>
                                    <div class="font-bold text-lg text-slate-800">Saat ve Hava Durumu</div>
                                    <div class="text-xs font-medium text-slate-400 uppercase tracking-widest">Glass Widget v1.1</div>
                                </div>
                            </div>
                            <button onclick="window.addWidget('weather_clock')" class="bg-blue-600 text-white px-6 py-3 rounded-2xl font-black text-xs uppercase shadow-md hover:bg-blue-700 transition-all">Ekle</button>
                        </div>
                    </div>
                </div>`;
            }
        };

        window.renderFileManager = function(winId, currentPath = '/home/admin') {
            const cont = document.getElementById(`win-content-${winId}`);
            
            // Mock dizin yapısı
            const directories = {
                '/': ['bin', 'etc', 'home', 'root', 'usr', 'var'],
                '/home': ['admin', 'guest'],
                '/home/admin': ['Belgeler', 'İndirilenler', 'Masaüstü', 'Resimler'],
                '/home/admin/Belgeler': [],
                '/root': ['secret.txt'],
                '/etc': ['system.conf', 'network.conf']
            };

            const folders = directories[currentPath] || [];
            // Notları dosya gibi gösterelim
            const notesAsFiles = currentPath === '/home/admin/Belgeler' ? systemData.notes.map(n => n.title + '.txt') : [];
            const allItems = [...folders, ...notesAsFiles];

            cont.innerHTML = `
                <div class="flex h-full bg-white text-slate-800 overflow-hidden">
                    <div class="sidebar-nav w-48 bg-slate-50 border-r border-slate-200 py-4">
                        <div class="px-6 mb-6">
                            <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">Favoriler</h4>
                            <div class="space-y-1">
                                <div onclick="window.renderFileManager('${winId}', '/home/admin')" class="flex items-center gap-2 p-2 hover:bg-slate-200 rounded-xl cursor-pointer text-xs font-bold ${currentPath.includes('/home/admin') ? 'text-blue-600 bg-blue-50' : ''}">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg> Ana Dizin
                                </div>
                                <div onclick="window.renderFileManager('${winId}', '/home/admin/Belgeler')" class="flex items-center gap-2 p-2 hover:bg-slate-200 rounded-xl cursor-pointer text-xs font-bold ${currentPath === '/home/admin/Belgeler' ? 'text-blue-600 bg-blue-50' : ''}">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path></svg> Belgeler
                                </div>
                            </div>
                        </div>
                        <div class="px-6">
                            <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">Sistem</h4>
                            <div class="space-y-1">
                                <div onclick="window.renderFileManager('${winId}', '/')" class="flex items-center gap-2 p-2 hover:bg-slate-200 rounded-xl cursor-pointer text-xs font-bold ${currentPath === '/' ? 'text-blue-600 bg-blue-50' : ''}">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6" y2="6"></line><line x1="6" y1="18" x2="6" y2="18"></line></svg> Root (/)
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex-grow flex flex-col">
                        <div class="p-3 bg-white border-b border-slate-100 flex items-center gap-4">
                            <div class="flex gap-1">
                                <button onclick="window.renderFileManager('${winId}', '/')" class="p-2 hover:bg-slate-100 rounded-lg text-slate-500 transition-all"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                            </div>
                            <div class="flex-grow bg-slate-50 border border-slate-200 rounded-xl px-4 py-1.5 text-[11px] font-bold text-slate-500 tracking-wide">${currentPath}</div>
                        </div>
                        <div class="p-6 overflow-y-auto grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-4 content-start">
                            ${allItems.map(item => {
                                const isFolder = !item.includes('.');
                                return `
                                <div class="flex flex-col items-center gap-2 p-3 hover:bg-blue-50 rounded-2xl cursor-pointer transition-all group" ondblclick="window.renderFileManager('${winId}', '${currentPath === '/' ? '' : currentPath}/${item}')">
                                    <div class="w-12 h-12 flex items-center justify-center transition-transform group-hover:scale-110">
                                        ${isFolder ? 
                                            '<svg class="text-yellow-500" width="40" height="40" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>' : 
                                            '<svg class="text-blue-500" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>'
                                        }
                                    </div>
                                    <span class="text-[10px] font-bold text-slate-700 text-center truncate w-full px-1">${item}</span>
                                </div>`;
                            }).join('')}
                            ${allItems.length === 0 ? '<div class="col-span-full mt-10 text-center text-xs font-bold text-slate-300 uppercase tracking-widest">Klasör Boş</div>' : ''}
                        </div>
                    </div>
                </div>
            `;
        };

        window.renderPackageInstaller = function(winId, pkgInfo = null) {
            const cont = document.getElementById(`win-content-${winId}`);
            if (pkgInfo) {
                cont.innerHTML = `
                    <div class="flex flex-col h-full bg-white p-8">
                        <div class="flex items-start gap-6 mb-8">
                            <div class="w-20 h-20 bg-slate-100 rounded-3xl flex items-center justify-center text-slate-400">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>
                            </div>
                            <div class="flex-grow">
                                <h2 class="text-2xl font-black text-slate-900">${pkgInfo.name}</h2>
                                <p class="text-xs font-bold text-blue-600 uppercase tracking-widest mt-1">${pkgInfo.ext} Paketi</p>
                                <div class="mt-4 flex gap-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                                    <span>Versiyon: 1.0.0</span>
                                    <span>Boyut: 4.2 MB</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex-grow bg-slate-50 rounded-3xl p-6 border border-slate-100 mb-8 overflow-y-auto">
                            <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">Paket Açıklaması</h4>
                            <p class="text-sm text-slate-600 font-medium leading-relaxed">
                                Bu bir sistem paketidir. Yüklendiğinde EdmorOs Core yapılandırmasına dahil edilecektir. Paket doğrulaması Linux Kernel Core tarafından tamamlanmıştır.
                            </p>
                        </div>
                        <div id="installProgress" class="hidden mb-6">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-[10px] font-black text-slate-400 uppercase">Yükleniyor...</span>
                                <span id="installPercent" class="text-[10px] font-black text-blue-600 font-mono">0%</span>
                            </div>
                            <div class="w-full h-2 bg-slate-100 rounded-full overflow-hidden">
                                <div id="installBar" class="h-full bg-blue-600 w-0 transition-all"></div>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="window.renderPackageInstaller('${winId}')" class="flex-grow bg-slate-100 text-slate-500 py-4 rounded-2xl font-black text-xs uppercase hover:bg-slate-200 transition-all">İPTAL</button>
                            <button id="startInstallBtn" onclick="window.startPackageInstall('${winId}')" class="flex-grow bg-blue-600 text-white py-4 rounded-2xl font-black text-xs uppercase shadow-lg hover:bg-blue-700 transition-all">PAKETİ YÜKLE</button>
                        </div>
                    </div>
                `;
            } else {
                cont.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full bg-slate-50 p-12 text-center">
                        <div class="w-24 h-24 bg-white rounded-[40px] flex items-center justify-center text-emerald-600 mb-8 shadow-xl border border-slate-100">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                        </div>
                        <h2 class="text-2xl font-black text-slate-900 mb-3 tracking-tight">Linux Paket Yükleyicisi</h2>
                        <p class="text-sm text-slate-500 font-medium mb-10 max-w-[280px] leading-relaxed">Sisteme entegre etmek istediğiniz <b>.deb</b> veya <b>.rpm</b> uzantılı paket dosyasını seçin.</p>
                        <input type="file" id="pkgLoader-${winId}" accept=".deb,.rpm" class="hidden" onchange="window.handlePackageSelect(event, '${winId}')">
                        <button onclick="document.getElementById('pkgLoader-${winId}').click()" class="bg-slate-900 text-white px-12 py-5 rounded-3xl font-black text-xs uppercase shadow-2xl hover:bg-blue-600 transition-all transform active:scale-95 tracking-widest">PAKET SEÇİN</button>
                        <div class="mt-8 text-[9px] font-black text-slate-300 uppercase tracking-[0.2em]">EdmorOs Core Package Manager v1.0</div>
                    </div>
                `;
            }
        };

        window.handlePackageSelect = function(e, winId) {
            const file = e.target.files[0];
            if (file) {
                const ext = file.name.split('.').pop().toUpperCase();
                if (ext === 'DEB' || ext === 'RPM') {
                    window.renderPackageInstaller(winId, { name: file.name, ext: ext });
                }
            }
        };

        window.startPackageInstall = function(winId) {
            const btn = document.getElementById('startInstallBtn');
            const progress = document.getElementById('installProgress');
            const bar = document.getElementById('installBar');
            const percent = document.getElementById('installPercent');
            
            btn.classList.add('hidden');
            progress.classList.remove('hidden');
            
            let p = 0;
            const timer = setInterval(() => {
                p += Math.floor(Math.random() * 15) + 5;
                if (p > 100) p = 100;
                bar.style.width = p + '%';
                percent.innerText = p + '%';
                
                if (p >= 100) {
                    clearInterval(timer);
                    setTimeout(() => {
                        const cont = document.getElementById(`win-content-${winId}`);
                        cont.innerHTML = `
                            <div class="flex flex-col items-center justify-center h-full bg-white p-12 text-center animate-fade-in">
                                <div class="w-20 h-20 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mb-6">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg>
                                </div>
                                <h2 class="text-2xl font-black text-slate-900">Kurulum Başarılı</h2>
                                <p class="text-sm text-slate-500 font-medium mt-2">Paket başarıyla Linux Core dizinine entegre edildi.</p>
                                <button onclick="window.renderPackageInstaller('${winId}')" class="mt-10 bg-slate-900 text-white px-10 py-4 rounded-2xl font-black text-xs uppercase shadow-lg">TAMAM</button>
                            </div>
                        `;
                    }, 500);
                }
            }, 300);
        };

        window.renderPDFReader = function(winId, pdfUrl = null) {
            const cont = document.getElementById(`win-content-${winId}`);
            if (pdfUrl) {
                cont.innerHTML = `
                <div class="flex flex-col h-full bg-slate-800">
                    <div class="p-3 bg-slate-900 border-b border-slate-700 flex justify-between items-center px-6">
                        <button onclick="window.renderPDFReader('${winId}')" class="text-xs font-black text-white hover:text-blue-400 transition-all uppercase tracking-widest flex items-center gap-2">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="15 18 9 12 15 6"></polyline></svg> Geri Dön
                        </button>
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em]">PDF Viewer Engine</span>
                    </div>
                    <embed src="${pdfUrl}#toolbar=1" type="application/pdf" class="w-full h-full" />
                </div>`;
            } else {
                cont.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full bg-slate-50 p-12 text-center">
                    <div class="w-20 h-20 bg-red-100 rounded-3xl flex items-center justify-center text-red-600 mb-6 shadow-sm">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="M9 15h3a1 1 0 0 1 0 2H9v-2z"></path><path d="M15 15h-3v4"></path></svg>
                    </div>
                    <h2 class="text-2xl font-black text-slate-800 mb-2">PDF Görüntüleyici</h2>
                    <p class="text-sm text-slate-500 font-medium mb-8 max-w-xs">Görüntülemek istediğiniz PDF dosyasını seçin.</p>
                    <input type="file" id="pdfLoader-${winId}" accept=".pdf" class="hidden" onchange="window.handlePDFUpload(event, '${winId}')">
                    <button onclick="document.getElementById('pdfLoader-${winId}').click()" class="bg-blue-600 text-white px-10 py-4 rounded-2xl font-black text-xs uppercase shadow-lg hover:bg-blue-700 transition-all transform active:scale-95">DOSYA SEÇİN</button>
                </div>`;
            }
        };

        window.handlePDFUpload = function(e, winId) {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                const url = URL.createObjectURL(file);
                window.renderPDFReader(winId, url);
            }
        };

        window.renderEdmorBrowser = function(winId) {
            const cont = document.getElementById(`win-content-${winId}`);
            if(!window.browserTabs[winId]) {
                window.browserTabs[winId] = { activeIndex: 0, tabs: [{ title: 'Google', url: 'https://www.google.com/search?igu=1' }] };
            }
            window.updateBrowserUI(winId);
        };

        window.updateBrowserUI = function(winId) {
            const cont = document.getElementById(`win-content-${winId}`);
            const state = window.browserTabs[winId];
            const currentTab = state.tabs[state.activeIndex];
            let tabHTML = state.tabs.map((t, idx) => `
                <div class="browser-tab ${idx === state.activeIndex ? 'active' : ''}" onclick="window.switchBrowserTab('${winId}', ${idx})">
                    <span class="truncate w-24 text-[10px]">${t.title}</span>
                    ${state.tabs.length > 1 ? `<span onclick="event.stopPropagation(); window.closeBrowserTab('${winId}', ${idx})" class="ml-2 hover:text-red-500 opacity-60">×</span>` : ''}
                </div>
            `).join('');

            cont.innerHTML = `
                <div class="flex flex-col h-full bg-white">
                    <div class="bg-slate-100 pt-2 px-2 flex items-end gap-1 border-b border-slate-200">
                        <div class="flex items-center gap-1 overflow-x-auto no-scrollbar">${tabHTML}</div>
                        <button onclick="window.addBrowserTab('${winId}')" class="p-2 mb-1 hover:bg-slate-200 rounded-lg text-slate-500 text-lg font-bold leading-none">+</button>
                    </div>
                    <div class="p-2 bg-white flex items-center gap-3 border-b border-slate-100 shadow-sm">
                        <div class="flex gap-1"><button onclick="window.refreshBrowser('${winId}')" class="p-2 hover:bg-slate-50 rounded-lg text-slate-500"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M23 4v6h-6"></path><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg></button></div>
                        <div class="flex-grow"><input id="browser-url-${winId}" type="text" value="${currentTab.url}" onkeydown="if(event.key==='Enter') window.navigateBrowser('${winId}', this.value)" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-1.5 text-xs outline-none focus:border-blue-500 transition-all"></div>
                    </div>
                    <iframe id="browser-frame-${winId}" src="${currentTab.url}" class="flex-grow w-full border-none"></iframe>
                </div>
            `;
        };

        window.switchBrowserTab = function(winId, idx) { window.browserTabs[winId].activeIndex = idx; window.updateBrowserUI(winId); };
        window.addBrowserTab = function(winId) { window.browserTabs[winId].tabs.push({ title: 'Yeni Sekme', url: 'https://www.google.com/search?igu=1' }); window.browserTabs[winId].activeIndex = window.browserTabs[winId].tabs.length - 1; window.updateBrowserUI(winId); };
        window.closeBrowserTab = function(winId, idx) { window.browserTabs[winId].tabs.splice(idx, 1); if(window.browserTabs[winId].activeIndex >= window.browserTabs[winId].tabs.length) window.browserTabs[winId].activeIndex = Math.max(0, window.browserTabs[winId].tabs.length - 1); window.updateBrowserUI(winId); };
        window.navigateBrowser = function(winId, input) { let url = input.trim(); if (!url) return; if (!url.includes('.') || url.includes(' ')) { url = 'https://www.google.com/search?q=' + encodeURIComponent(url) + '&igu=1'; } else { if(!url.startsWith('http')) url = 'https://' + url; } const state = window.browserTabs[winId]; state.tabs[state.activeIndex].url = url; try { state.tabs[state.activeIndex].title = new URL(url).hostname.replace('www.', ''); } catch(e) { state.tabs[state.activeIndex].title = 'Yükleniyor...'; } window.updateBrowserUI(winId); };
        window.refreshBrowser = function(winId) { const iframe = document.getElementById(`browser-frame-${winId}`); if(iframe) { const src = iframe.src; iframe.src = 'about:blank'; setTimeout(() => iframe.src = src, 10); } };

        window.renderAboutApp = function(winId) {
            const cont = document.getElementById(`win-content-${winId}`);
            cont.innerHTML = `
                <div class="p-8 h-full bg-white overflow-y-auto">
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-black text-slate-900 tracking-tighter">Edmor<span class="text-blue-600">Os</span></h1>
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mt-2">Sürüm ${SYSTEM_VERSION}</p>
                    </div>
                    <div class="space-y-8">
                        <section>
                            <h3 class="text-xs font-black text-slate-900 uppercase tracking-widest mb-3 flex items-center gap-2">
                                <span class="w-1.5 h-4 bg-blue-600 rounded-full"></span> EdmorOs Nedir?
                            </h3>
                            <p class="text-sm text-slate-600 leading-relaxed font-medium">
                                EdmorOs, sadece bir arayüz simülasyonu değil; gücünü doğrudan <b>Linux çekirdeğinden</b> alan, modern web teknolojileriyle harmanlanmış Linux tabanlı bir WebOS sistemidir. 
                                Web tarayıcınızın içerisinde gerçek bir işletim sistemi katmanı gibi çalışarak, kernel düzeyinde stabilite ve modern bir kullanıcı deneyimi sunar.
                            </p>
                        </section>
                        <section>
                            <h3 class="text-xs font-black text-slate-900 uppercase tracking-widest mb-3 flex items-center gap-2">
                                <span class="w-1.5 h-4 bg-blue-600 rounded-full"></span> Vizyonumuz
                            </h3>
                            <p class="text-sm text-slate-600 leading-relaxed font-medium">
                                Hedefimiz, donanımdan bağımsız olarak her cihazda yüksek performanslı bir masaüstü deneyimi sağlamaktır. EdmorOs, "Cloud-Native" mimarisiyle yerel depolama risklerini minimize ederken, Linux'un özgürlükçü yapısını web'e taşır.
                            </p>
                        </section>
                        <section>
                            <h3 class="text-xs font-black text-slate-900 uppercase tracking-widest mb-3 flex items-center gap-2">
                                <span class="w-1.5 h-4 bg-blue-600 rounded-full"></span> Temel Teknolojiler
                            </h3>
                            <ul class="text-sm text-slate-600 space-y-2 font-medium">
                                <li class="flex items-center gap-2"><svg class="text-blue-600" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg> Linux Kernel Core</li>
                                <li class="flex items-center gap-2"><svg class="text-blue-600" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg> High-Performance Web Engine</li>
                                <li class="flex items-center gap-2"><svg class="text-blue-600" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg> Sandbox Application Isolation</li>
                            </ul>
                        </section>
                    </div>
                </div>`;
        };

        window.renderNotepadApp = function(winId, noteId = null) {
            const cont = document.getElementById(`win-content-${winId}`);
            if (noteId) {
                const note = systemData.notes.find(n => n.id === noteId);
                cont.innerHTML = `<div class="flex flex-col h-full bg-white"><div class="p-4 border-b flex justify-between items-center"><button onclick="window.renderNotepadApp('${winId}')" class="p-2">←</button><input id="noteTitle-${noteId}" type="text" value="${note.title}" class="font-bold outline-none flex-grow mx-4"><button id="saveBtn-${noteId}" onclick="window.saveNote('${noteId}')" class="bg-blue-600 text-white px-4 py-1 rounded-lg text-xs">KAYDET</button></div><textarea id="noteContent-${noteId}" class="flex-grow p-6 outline-none resize-none">${note.content}</textarea></div>`;
            } else {
                let list = systemData.notes.map(n => `<div onclick="window.renderNotepadApp('${winId}', ${n.id})" class="p-4 bg-white border rounded-xl mb-2 cursor-pointer hover:bg-slate-50 relative group"><b>${n.title || 'Başlıksız'}</b><br><small>${n.date}</small><button onclick="event.stopPropagation(); window.deleteNote(${n.id}, '${winId}')" class="absolute right-4 top-4 text-red-500 opacity-0 group-hover:opacity-100">Sil</button></div>`).join('');
                cont.innerHTML = `<div class="p-6 bg-slate-50 h-full overflow-y-auto"><div class="flex justify-between items-center mb-4"><h2 class="font-black">Notlarım</h2><button onclick="window.createNote('${winId}')" class="bg-blue-600 text-white w-10 h-10 rounded-full">+</button></div>${list || '<center class="mt-20 opacity-30">Not yok</center>'}</div>`;
            }
        };

        window.createNote = function(winId) { const id = Date.now(); systemData.notes.push({ id, title: "Yeni Not", content: "", date: new Date().toLocaleDateString() }); window.syncToDisk(); window.renderNotepadApp(winId, id); };
        window.saveNote = function(id) { const idx = systemData.notes.findIndex(n => n.id == id); systemData.notes[idx].title = document.getElementById(`noteTitle-${id}`).value; systemData.notes[idx].content = document.getElementById(`noteContent-${id}`).value; window.syncToDisk(); const btn = document.getElementById(`saveBtn-${id}`); btn.innerText = "KAYDEDİLDİ"; btn.style.background = "#10b981"; setTimeout(() => { btn.innerText = "KAYDET"; btn.style.background = "#2563eb"; }, 1000); };
        window.deleteNote = function(id, winId) { systemData.notes = systemData.notes.filter(n => n.id != id); window.syncToDisk(); window.renderNotepadApp(winId); };

        window.renderTaskManager = function(winId) { const cont = document.getElementById(`win-content-${winId}`); if(taskManagerInterval) clearInterval(taskManagerInterval); const draw = () => { const wins = document.querySelectorAll('.window'); cont.innerHTML = `<div class="p-4 h-full bg-slate-50 flex flex-col"><h3 class="font-bold mb-4">İşlemler (${wins.length})</h3><div class="flex-grow overflow-y-auto">` + Array.from(wins).map(w => `<div class="flex justify-between p-3 bg-white border rounded-lg mb-2"><span>${w.id.replace('window-','')}</span><button onclick="window.closeWindow('${w.id.replace('window-','')}')" class="text-red-500 text-xs font-bold">SONLANDIR</button></div>`).join('') + `</div></div>`; }; draw(); taskManagerInterval = setInterval(draw, 2000); };
        window.renderShortcutsApp = function(winId) { document.getElementById(`win-content-${winId}`).innerHTML = `<div class="p-8 h-full bg-white overflow-y-auto"><h2 class="text-2xl font-black mb-6">Klavye Kısayolları</h2><div class="space-y-4">` + [['Alt + S', 'Başlat Menüsü'], ['Alt + K', 'Hesap Makinesi'], ['Alt + N', 'Not Defteri'], ['Alt + T', 'Terminal'], ['Esc', 'Pencere Kapat']].map(k => `<div class="flex justify-between border-b pb-2"><span class="font-bold text-slate-700">${k[1]}</span><span class="kbd-key">${k[0]}</span></div>`).join('') + `</div></div>`; };

        window.renderSettingsApp = function(winId) { const cont = document.getElementById(`win-content-${winId}`); cont.innerHTML = window.generateSettingsHTML(); setTimeout(() => { const b = cont.querySelector('.tab-btn'); if(b) window.switchSettingsTab(b, 'system'); }, 20); };
        window.generateSettingsHTML = function() { return `<div class="flex h-full bg-white text-slate-800 overflow-hidden"><div class="sidebar-nav"><div class="px-8 pb-8 mb-4 border-b border-slate-100"><div class="w-12 h-12 rounded-2xl bg-blue-600 mb-3 flex items-center justify-center text-white font-black text-xl shadow-lg">A</div><div class="text-xs font-black truncate">${systemData.username}</div></div><div class="tab-btn active" onclick="window.switchSettingsTab(this, 'system')">Sistem</div><div class="tab-btn" onclick="window.switchSettingsTab(this, 'apps')">Uygulamalar</div><div class="tab-btn" onclick="window.switchSettingsTab(this, 'appearance')">Görünüm</div></div><div class="flex-grow p-10 overflow-y-auto" id="settingsBody"></div></div>`; };
        window.runUpdateCheck = function(btn) { const originalText = btn.innerText; btn.disabled = true; btn.innerText = "PAKETLER KARŞILAŞTIRILIYOR..."; setTimeout(() => { btn.innerHTML = '<span class="text-white">SİSTEM GÜNCEL</span>'; setTimeout(() => { btn.innerText = originalText; btn.disabled = false; }, 3000); }, 2000); };
        window.switchSettingsTab = function(btn, tab) {
            const body = document.getElementById('settingsBody'); if(!body) return;
            const settingsWin = document.getElementById('window-settings');
            if(settingsWin) { settingsWin.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); } else { document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); }
            btn.classList.add('active');
            if(tab === 'system') { const s = getStorageInfo(); body.innerHTML = `<h2 class="text-3xl font-black mb-8">Sistem</h2><div class="p-6 bg-slate-50 rounded-3xl border border-slate-100 mb-6"><p class="font-bold text-slate-600 mb-1">Versiyon</p><p class="font-black text-blue-600">${SYSTEM_VERSION}</p></div><div class="p-6 bg-slate-50 rounded-3xl border border-slate-100"><h3 class="text-xs font-black text-slate-400 mb-4 uppercase tracking-widest">Depolama (%${s.percent})</h3><div class="w-full h-3 bg-slate-200 rounded-full overflow-hidden mb-3"><div class="h-full bg-blue-600" style="width: ${s.percent}%"></div></div></div>`; }
            else if(tab === 'apps') { let h = `<h2 class="text-3xl font-black mb-8">Uygulamalar</h2><div class="space-y-3">`; Object.values(SYSTEM_APPS).forEach(a => h += `<div class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100"><span class="font-bold text-slate-700">${a.title}</span></div>`); body.innerHTML = h + "</div>"; }
            else if(tab === 'appearance') { 
                let h = `<h2 class="text-3xl font-black mb-8">Görünüm</h2>
                        <div class="space-y-8">
                            <div>
                                <h3 class="text-xs font-black text-slate-400 mb-4 uppercase tracking-widest flex justify-between">
                                    Ölçeklendirme <span>${Math.round(systemData.ui_scale * 100)}%</span>
                                </h3>
                                <input type="range" min="0.5" max="1.5" step="0.05" value="${systemData.ui_scale}" oninput="window.setUIScale(this.value); this.previousElementSibling.firstElementChild.innerText = Math.round(this.value * 100) + '%'" class="w-full mb-2">
                            </div>
                            <div>
                                <h3 class="text-xs font-black text-slate-400 mb-4 uppercase tracking-widest flex justify-between">
                                    Yazı Tipi Boyutu <span>${systemData.font_size}px</span>
                                </h3>
                                <input type="range" min="12" max="24" step="1" value="${systemData.font_size}" oninput="window.setFontSize(this.value); this.previousElementSibling.firstElementChild.innerText = this.value + 'px'" class="w-full mb-2">
                            </div>
                        </div>`; 
                body.innerHTML = h; 
                window.updateSliderGradients(); 
            }
        };

        window.openAppSettings = function() { window.openApp('settings'); };
        window.generateStoreHTML = function() { return `<div class="flex h-full bg-white text-slate-800 overflow-hidden"><div class="sidebar-nav"><div class="px-8 pb-4 text-2xl font-black tracking-tight text-slate-900">Mağaza</div><div class="tab-btn active" onclick="window.switchStoreTab(this, 'media')">Medya</div></div><div class="flex-grow p-12 overflow-y-auto" id="storeBody">${window.generateStoreGrid('media')}</div></div>`; };
        window.switchStoreTab = function(btn, cat) { activeStoreTab = cat; const storeWin = document.getElementById('window-store'); if(storeWin) storeWin.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); document.getElementById('storeBody').innerHTML = window.generateStoreGrid(cat); };
        window.generateStoreGrid = function(cat) { let h = `<h2 class="text-3xl font-black text-slate-900 mb-8 uppercase tracking-tight">${cat==='media'?'Medya':'Sistem'}</h2><div class="flex flex-col gap-4">`; Object.values(STORE_APPS).filter(a => a.category === cat).forEach(a => { const isIns = systemData.installed_apps.includes(a.id); h += `<div class="store-item flex justify-between items-center p-6 bg-slate-50 rounded-3xl border border-slate-100"><div class="flex items-center gap-4"><div class="w-12 h-12 ${a.icon} rounded-xl flex items-center justify-center text-white shadow-lg">${a.svg}</div><div><b class="text-lg">${a.title}</b><br><small class="text-slate-400 font-bold uppercase tracking-widest">${a.size} MB</small></div></div><button onclick="window.installApp('${a.id}')" class="install-btn ${isIns?'installed':''}">${isIns?'YÜKLENDİ':'YÜKLE'}</button></div>`; }); return h + "</div>"; };
        window.installApp = function(id) { if(systemData.installed_apps.includes(id)) return; systemData.installed_apps.push(id); window.syncToDisk(); const storeBody = document.getElementById('storeBody'); if(storeBody) storeBody.innerHTML = window.generateStoreHTML(); };
        window.uninstallApp = function(id) { systemData.installed_apps = systemData.installed_apps.filter(x => x !== id); window.syncToDisk(); window.closeWindow(id); };

        window.changeCal = function(dir) { calState.month += dir; if (calState.month > 11) { calState.month = 0; calState.year++; } else if (calState.month < 0) { calState.month = 11; calState.year--; } const winCont = document.getElementById('win-content-calendar'); if (winCont) winCont.innerHTML = window.generateCalendarHTML(); };
        window.generateCalendarHTML = function() { 
            const names = ["Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"];
            const days = ["Pt", "Sa", "Çr", "Pr", "Cu", "Ct", "Pz"];
            const now = new Date();
            const firstDayOfMonth = new Date(calState.year, calState.month, 1).getDay();
            const totalDays = new Date(calState.year, calState.month + 1, 0).getDate();
            let startOffset = (firstDayOfMonth + 6) % 7;
            let h = `<div class="p-8 h-full bg-white overflow-y-auto"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-black">${names[calState.month]} ${calState.year}</h2><div class="flex gap-2"><button onclick="window.changeCal(-1)" class="p-2 hover:bg-slate-100 rounded-full transition-all">←</button><button onclick="window.changeCal(1)" class="p-2 hover:bg-slate-100 rounded-full transition-all">→</button></div></div><div class="calendar-grid">`;
            days.forEach(d => h += `<div class="calendar-day-name">${d}</div>`);
            for (let i = 0; i < startOffset; i++) { h += `<div class="calendar-day opacity-0"></div>`; }
            for (let i = 1; i <= totalDays; i++) { const isToday = now.getDate() === i && now.getMonth() === calState.month && now.getFullYear() === calState.year; h += `<div class="calendar-day ${isToday ? 'today' : ''}">${i}</div>`; }
            h += `</div></div>`; return h;
        };

        window.renderWeatherApp = async function(winId) { const cont = document.getElementById(`win-content-${winId}`); cont.innerHTML = `<center class="p-20"><div class="spinner"></div></center>`; const loc = await window.getLiveLocation(); if(!loc) { cont.innerHTML = `<div class="h-full flex items-center justify-center bg-slate-50 font-bold text-slate-400 uppercase tracking-widest">Konum Alınamadı</div>`; return; } try { const w = await fetchWithBackoff(`https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lon}&current_weather=true`); cont.innerHTML = `<div class="h-full bg-gradient-to-br from-blue-500 to-indigo-700 text-white flex flex-col items-center justify-center"><h2>${loc.city || 'Konum'}</h2><h1 class="text-8xl font-black mt-2 tracking-tighter">${Math.round(w.current_weather.temperature)}°</h1></div>`; } catch(e) { cont.innerHTML = `<center class="p-20">Veri Hatası</center>`; } };
        window.renderCalculatorApp = function(winId) { const cont = document.getElementById(`win-content-${winId}`); cont.innerHTML = `<div class="flex flex-col h-full bg-slate-50 p-4 select-none"><div id="calcDisplay" class="bg-white border rounded-2xl p-6 text-right text-3xl font-black text-slate-800 mb-4 shadow-sm">0</div><div class="grid grid-cols-4 gap-2 flex-grow">${['C','±','%','÷','7','8','9','×','4','5','6','-','1','2','3','+','0','.','='].map(btn => `<button onclick="window.handleCalc('${btn}')" class="h-12 rounded-xl font-bold ${['÷','×','-','+','='].includes(btn)?'bg-orange-500 text-white':'bg-white border text-slate-700'} ${btn==='0'?'col-span-2':''}">${btn}</button>`).join('')}</div></div>`; window.calcData = { current: '0', prev: null, op: null, reset: false }; };
        window.handleCalc = function(val) { const disp = document.getElementById('calcDisplay'); if(!disp) return; if(!isNaN(val)) { if(window.calcData.current==='0' || window.calcData.reset){window.calcData.current=val;window.calcData.reset=false;} else window.calcData.current+=val; } else if(val==='C') window.calcData = {current:'0',prev:null,op:null,reset:false}; else if(val==='=') { if(window.calcData.prev && window.calcData.op){ const p=parseFloat(window.calcData.prev), c=parseFloat(window.calcData.current); let r=0; if(window.calcData.op==='+')r=p+c; if(window.calcData.op==='-')r=p-c; if(window.calcData.op==='×')r=p*c; if(window.calcData.op==='÷')r=p/c; window.calcData.current=r.toString(); window.calcData.reset=true; } } else { window.calcData.prev=window.calcData.current; window.calcData.op=val; window.calcData.reset=true; } disp.innerText = window.calcData.current; };

        window.setUIScale = function(v) { systemData.ui_scale = parseFloat(v); window.applyVisuals(); window.syncToDisk(); };
        window.setFontSize = function(v) { systemData.font_size = parseInt(v); window.applyVisuals(); window.syncToDisk(); };
        window.toggleStartMenu = function() { const m = document.getElementById('startMenu'); m.style.display = m.style.display === 'flex' ? 'none' : 'flex'; };
        window.toggleVolumePopup = function() { const v = document.getElementById('volumePopup'); v.style.display = v.style.display === 'flex' ? 'none' : 'flex'; };
        
        // --- WIFI POPUP VE GERÇEK VERİ ENTEGRASYONU ---
        window.toggleWifiPopup = function() { 
            const w = document.getElementById('wifiPopup'); 
            const isVisible = w.style.display === 'flex'; 
            w.style.display = isVisible ? 'none' : 'flex'; 
            if(!isVisible) window.renderWifiList(); 
        };

        window.renderWifiList = async function() {
            const list = document.getElementById('wifiList');
            const spinner = document.querySelector('#wifiPopup .spinner');
            
            if(spinner) spinner.style.display = 'block';
            
            try {
                // Main.js + Preload.js üzerinden gelen gerçek veriyi istiyoruz
                const networks = await window.electronAPI.scanWifi();
                
                if(spinner) spinner.style.display = 'none';

                if (!networks || networks.length === 0) {
                    list.innerHTML = `<div class="text-[10px] text-center p-4 text-slate-400 font-bold uppercase tracking-widest">Ağ Bulunamadı</div>`;
                    return;
                }

                list.innerHTML = networks.map(nw => {
                    // nmcli'den gelen sinyal gücü verisiyle çubukları yakıyoruz
                    const s = nw.bars ? nw.bars.trim().length : 0; 
                    return `
                    <div class="wifi-list-item" onclick="window.connectToWifi('${nw.ssid}')">
                        <span class="wifi-name">${nw.ssid}</span>
                        <div class="wifi-signal-bars">
                            <div class="wifi-bar h-1.5 ${s >= 1 ? 'active' : ''}"></div>
                            <div class="wifi-bar h-2.5 ${s >= 2 ? 'active' : ''}"></div>
                            <div class="wifi-bar h-3.5 ${s >= 3 ? 'active' : ''}"></div>
                            <div class="wifi-bar h-4.5 ${s >= 4 ? 'active' : ''}"></div>
                        </div>
                    </div>`;
                }).join('');

            } catch (err) {
                if(spinner) spinner.style.display = 'none';
                list.innerHTML = `<div class="text-[10px] text-center p-4 text-red-400 font-bold">Hata: Motor Bağlı Değil</div>`;
                console.error("Wi-Fi Scan Hatası:", err);
            }
        };

        window.connectToWifi = function(ssid) {
            alert(`${ssid} ağına bağlanmak için şifre penceresi yakında eklenecek!`);
        };

        window.updateVolume = function(val) { document.getElementById('volumeValue').innerText = val + '%'; window.updateSliderGradients(); };
        window.closeWelcome = function() { document.getElementById('welcomeGate').style.display = 'none'; };
        window.completeSetup = function() { const user = document.getElementById('setupUsername').value.trim() || "Admin"; systemData.username = user; systemData.setup_complete = true; window.syncToDisk(); document.getElementById('setupScreen').style.opacity = '0'; setTimeout(() => { document.getElementById('setupScreen').style.display = 'none'; document.getElementById('loginDisplayUser').innerText = user; document.getElementById('agreementScreen').style.display = 'flex'; }, 500); };
        window.toggleAgreementBtn = function() { const check = document.getElementById('agreeCheck'); const btn = document.getElementById('agreementNextBtn'); if(check.checked) { btn.disabled = false; btn.classList.remove('opacity-40', 'cursor-not-allowed'); } else { btn.disabled = true; btn.classList.add('opacity-40', 'cursor-not-allowed'); } };
        window.completeAgreement = function() { systemData.agreement_accepted = true; window.syncToDisk(); document.getElementById('agreementScreen').style.opacity = '0'; setTimeout(() => { document.getElementById('agreementScreen').style.display = 'none'; document.getElementById('loginScreen').style.display = 'flex'; }, 500); };
        window.performLogin = function() { document.getElementById('loginScreen').style.opacity = '0'; setTimeout(() => { document.getElementById('loginScreen').style.display = 'none'; document.getElementById('desktop').style.display = 'block'; document.getElementById('welcomeGate').style.display = 'flex'; if(systemData.widgets) systemData.widgets.forEach(w => window.addWidget(w.type, w.x, w.y, w.id)); }, 500); };
        window.filterApps = function() { const q = document.getElementById('menuSearch').value.toLowerCase(); document.querySelectorAll('.launch-item').forEach(i => { i.style.display = i.querySelector('.launch-label').innerText.toLowerCase().includes(q) ? 'flex' : 'none'; }); };

        window.startBoot = function() {
            const bar = document.getElementById('bootBar'); let prg = 0;
            const timer = setInterval(() => { 
                prg += 5; if(bar) bar.style.width = prg + '%'; 
                if(prg >= 100) { 
                    clearInterval(timer); window.loadSystemData(); window.renderLaunchpad(); 
                    setTimeout(() => { 
                        const bs = document.getElementById('bootScreen'); 
                        if(bs) bs.style.opacity = '0'; 
                        setTimeout(() => { 
                            if(bs) bs.style.display = 'none'; 
                            if (!systemData.setup_complete) { document.getElementById('setupScreen').style.display = 'flex'; } 
                            else if (!systemData.agreement_accepted) { document.getElementById('loginDisplayUser').innerText = systemData.username; document.getElementById('agreementScreen').style.display = 'flex'; } 
                            else { document.getElementById('loginDisplayUser').innerText = systemData.username; document.getElementById('loginScreen').style.display = 'flex'; }
                        }, 500); 
                    }, 500);
                }
            }, 40);
        };

        window.addWidget = async function(type, initialX = 60, initialY = 60, widgetId = null) {
            const id = widgetId || 'w-' + Date.now();
            if(!widgetId) { if(!systemData.widgets) systemData.widgets = []; systemData.widgets.push({ id, type, x: initialX, y: initialY }); window.syncToDisk(); }
            const container = document.getElementById('widgetContainer'); if(!container) return;
            const widget = document.createElement('div'); widget.id = id; widget.className = 'widget glass pointer-events-auto';
            widget.style.left = initialX + 'px'; widget.style.top = initialY + 'px';
            const closeBtn = document.createElement('div'); closeBtn.className = 'widget-close'; closeBtn.innerHTML = '×';
            closeBtn.onclick = (e) => { e.stopPropagation(); systemData.widgets = systemData.widgets.filter(w => w.id !== id); widget.remove(); window.syncToDisk(); };
            widget.appendChild(closeBtn);
            const loc = await window.getLiveLocation();
            if(type === 'weather_clock') {
                const content = document.createElement('div'); content.innerHTML = `<div class="flex flex-col items-center gap-2 text-slate-800"><div id="w-clock" class="text-4xl font-black tracking-tighter text-center">00:00</div></div>`; widget.appendChild(content);
                const updateWClock = () => { const n = new Date(); const el = widget.querySelector('#w-clock'); if(el) el.innerText = String(n.getHours()).padStart(2,'0') + ":" + String(n.getMinutes()).padStart(2,'0'); }; setInterval(updateWClock, 1000); updateWClock();
            }
            container.appendChild(widget); window.makeDraggableWidget(widget, id);
        };

        window.makeDraggableWidget = function(el, id) { let p1=0, p2=0, p3=0, p4=0; el.onmousedown = (e) => { if(e.target.className === 'widget-close') return; e.preventDefault(); p3 = e.clientX; p4 = e.clientY; document.onmousemove = (ev) => { p1 = p3 - ev.clientX; p2 = p4 - ev.clientY; p3 = ev.clientX; p4 = ev.clientY; el.style.top = (el.offsetTop - p2) + "px"; el.style.left = (el.offsetLeft - p1) + "px"; }; document.onmouseup = () => { document.onmousemove = null; const wD = systemData.widgets.find(w => w.id === id); if(wD) { wD.x = parseInt(el.style.left); wD.y = parseInt(el.style.top); window.syncToDisk(); } document.onmouseup = null; }; }; };

        document.addEventListener('keydown', (e) => {
            const isTyping = ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName);
            const calcWin = document.getElementById('window-calculator');
            const calcIsActive = calcWin && !calcWin.classList.contains('hidden') && !calcWin.classList.contains('minimized');
            if (e.key === 'Escape') { const wins = Array.from(document.querySelectorAll('.window:not(.hidden):not(.closing)')).sort((a,b) => b.style.zIndex - a.style.zIndex); if (wins.length > 0) { const id = wins[0].id.replace('window-', ''); window.closeWindow(id); } const sm = document.getElementById('startMenu'); if (sm && sm.style.display === 'flex') window.toggleStartMenu(); }
            if (calcIsActive && !isTyping) { if (!isNaN(e.key) && e.key !== ' ') { window.handleCalc(e.key); } else if (e.key === '+' || e.key === '-') { window.handleCalc(e.key); } else if (e.key === 'Enter' || e.key === '=') { e.preventDefault(); window.handleCalc('='); } else if (e.key === 'Backspace' || e.key === 'Delete') { window.handleCalc('C'); } }
            if (!isTyping && e.altKey) { e.preventDefault(); switch(e.key.toLowerCase()) { case 's': window.toggleStartMenu(); break; case 'k': window.openApp('calculator'); break; case 'n': window.openApp('notepad'); break; case 't': window.openApp('terminal'); break; } }
        });

        document.addEventListener('DOMContentLoaded', window.startBoot);
        document.addEventListener('click', (e) => { 
            if(!e.target.closest('#startButton') && !e.target.closest('#startMenu')) { const sm = document.getElementById('startMenu'); if(sm) sm.style.display = 'none'; }
            if(!e.target.closest('.relative')) { const vp = document.getElementById('volumePopup'); if(vp) vp.style.display = 'none'; const wp = document.getElementById('wifiPopup'); if(wp) wp.style.display = 'none'; }
            const cm = document.getElementById('contextMenu'); if(cm) cm.style.display = 'none';
        });
        document.addEventListener('contextmenu', (e) => {
            if(e.target.id === 'desktop' || e.target.parentElement?.id === 'desktop' || e.target.id === 'ui-wrapper' || e.target.classList.contains('desktop')) {
                e.preventDefault(); const m = document.getElementById('contextMenu'); m.style.display = 'block'; m.style.left = e.clientX + 'px'; m.style.top = e.clientY + 'px';
            }
        });
        setInterval(() => { const n = new Date(); const h = document.getElementById('clock-h'), m = document.getElementById('clock-m'); if(h) h.innerText = String(n.getHours()).padStart(2,'0'); if(m) m.innerText = String(n.getMinutes()).padStart(2,'0'); }, 1000);
    </script>
</body>
</html>